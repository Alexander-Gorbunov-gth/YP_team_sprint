# Структура


### Два микросервиса
1. Микросервис нотификации (отвечает за формирование писем и их отправку). Отправляются сообщения с помощью воркеров. В этом же микросервисе шаблоны для отправки сообщений, а также админка для создания шаблонов и рассылок.

Структура микросервиса:
### PostgreSQL 
Храним данные сообщений со следующими полями: 
- ID (UUID)
- Шаблон отправки - message_template (FK (UUID))
- Время отправки - send_at (datetime)
- Пользователь отправки - sent_to (UUID)
- Статус - status (Enum (запланировано, отменено, ошибка, отправлено))
Еще база данных с templates для отправки message_template:
- ID (UUID)
- Ключ шаблона - template_key ??? (к примеру welcome_email)
- Канал отправки -channel (Enum (sms, Websocket, email))
- Тело письмо - body (HTML)
- Параметры, который нужно вставить - params ???
### RabbitMQ 
Используем как брокер сообщений, для получения запросов на отправку сообщений из других микросервисов. А также для брокера для taskiq
### Taskiq 
Используем как воркер для отправки сообщений, а также для постоянной проверки (каждую минуту) какие сообщения нужно отправить.

2. Микросервис сокращения ссылок. 
Структура микросервиса:
### PostgreSQL
Структура БД 
- ID 
- Сокращаемая ссылка
- Сокращенная ссылка 
- Время хранения
### Taskiq 
Проходит раз в день и смотрит какие ссылки надо удалить по времени хранения

### Endpoints
`/{link}` где link это сокращенная ссылка, которая была сокращена. Редиректит на сокращаемую ссылку.

`create` - сокращает ссылку, (сделать метод, get_or_create) если ссылка на такой url уже есть - просто возвращает ее 


